#!/bin/bash


START=$(date +%s)
ENV=${1:-'py36'}
ENVS=('py27' 'py33' 'py34' 'py35' 'py36')

run_test () {
    echo 'Running tests for '$1'... START'
    docker build -t pact-test-$1 -f ./tests/environments/Dockerfile$1 . && \
    docker run pact-test-$1 py.test
    echo 'Running tests for '$1'... DONE'
}

help () {
    echo '--------------------------------------------------------'
    echo 'Usage: test <ENV>'
    echo ''
    echo 'Available values for <ENV>: py27, py33, py34, py35, py36'
    echo '--------------------------------------------------------'
}

if [[ "${ENVS[*]}" == *$ENV* ]]; then
    run_test $ENV
elif [ "$ENV" == "all" ]; then
    for i in "${ENVS[@]}"
    do
        run_test $i
    done
else
   help
fi

END=$(date +%s)
DELTA=$(($END - $START))

echo
echo 'Execution completed in' $DELTA 'seconds.'